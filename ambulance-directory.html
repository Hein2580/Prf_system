<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ambulance Directory</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .status-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        .status-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #b71c1c;
            transition: .4s;
            border-radius: 30px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #2e7d32;
        }
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
            text-align: center;
            min-width: 80px;
            display: inline-block;
        }
        .status-available {
            background: #e8f5e8;
            color: #2e7d32;
        }
        .status-on-call {
            background: #fff3e0;
            color: #f57c00;
        }
        .status-out-of-service {
            background: #ffebee;
            color: #b71c1c;
        }
        .dark-mode .status-available {
            background: #1b5e20;
            color: #c8e6c9;
        }
        .dark-mode .status-on-call {
            background: #e65100;
            color: #ffcc02;
        }
        .dark-mode .status-out-of-service {
            background: #8e0000;
            color: #ffcdd2;
        }
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .toggle-label {
            font-size: 0.8rem;
            color: #666;
        }
        .dark-mode .toggle-label {
            color: #b0b0b0;
        }
    </style>
</head>
<body>
    <header>
        <h1>Ambulance Directory</h1>
        <p>Manage your ambulance fleet</p>
    </header>
      <nav>
    <a href="dashboard.html">Dashboard</a>
    <a href="ambulance-directory.html" class="active">Ambulance Directory</a>
    <a href="checklist.html">Checklist</a>
                            <a href="prf-form.html">PRF Form</a>
        <a href="trip-log.html">Trip Log</a>
        <a href="settings.html">Settings</a>
    <button id="logoutBtn" style="background:#b71c1c;margin-left:auto;">Logout</button>
  </nav>
    <main>
        <h2>Ambulances</h2>
        <div class="table-container">
            <table id="ambulanceTable">
            <thead>
                <tr>
                    <th>Call Sign</th>
                    <th>Status</th>
                    <th>Quick Toggle</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
        </div>
        <h3>Add / Edit Ambulance</h3>
        <form id="ambulanceForm">
            <label for="callSign">Call Sign</label>
            <input type="text" id="callSign" name="callSign" required>
            <label for="status">Status</label>
            <select id="status" name="status">
                <option value="Available">Available</option>
                <option value="On Call">On Call</option>
                <option value="Out of Service">Out of Service</option>
            </select>
            <input type="hidden" id="editIndex">
            <button type="submit">Save Ambulance</button>
            <button type="button" id="cancelEdit" style="display:none; margin-left:1rem;">Cancel</button>
        </form>
        <div id="ambulanceSavedMsg" style="display:none;color:green;">Ambulance saved!</div>
    </main>
    <script src="tools.js"></script>
    <script>
        // Ambulance Directory Logic
        function loadAmbulances() {
            let ambulances = getAmbulances();
            
            // Add default ambulances if none exist
            if (ambulances.length === 0) {
                ambulances = [
                    { callSign: 'A1', status: 'Available' },
                    { callSign: 'A2', status: 'Available' },
                    { callSign: 'A3', status: 'Available' }
                ];
                saveAmbulances(ambulances);
            }
            
            const tbody = document.querySelector('#ambulanceTable tbody');
            tbody.innerHTML = '';
            ambulances.forEach((amb, idx) => {
                const statusClass = getStatusClass(amb.status);
                const isAvailable = amb.status === 'Available';
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${amb.callSign}</strong></td>
                    <td><span class="status-badge ${statusClass}">${amb.status}</span></td>
                    <td>
                        <div class="toggle-container">
                            <span class="toggle-label">Off</span>
                            <label class="status-toggle">
                                <input type="checkbox" ${isAvailable ? 'checked' : ''} onchange="toggleAmbulanceStatus(${idx})">
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="toggle-label">On</span>
                        </div>
                    </td>
                    <td>
                        <button onclick="editAmbulance(${idx})">Edit</button>
                        <button onclick="deleteAmbulance(${idx})" style="background:#b71c1c;">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        function getStatusClass(status) {
            switch(status) {
                case 'Available': return 'status-available';
                case 'On Call': return 'status-on-call';
                case 'Out of Service': return 'status-out-of-service';
                default: return 'status-available';
            }
        }
        function getAmbulances() {
            return JSON.parse(localStorage.getItem('ambulances') || '[]');
        }
        function saveAmbulances(arr) {
            localStorage.setItem('ambulances', JSON.stringify(arr));
        }
        function showMessage(msg) {
            const msgDiv = document.getElementById('ambulanceSavedMsg');
            msgDiv.textContent = msg;
            msgDiv.style.display = 'block';
            setTimeout(() => {
                msgDiv.style.display = 'none';
            }, 2000);
        }
        document.getElementById('ambulanceForm').onsubmit = async function(e) {
            e.preventDefault();
            const callSign = document.getElementById('callSign').value.trim().toUpperCase();
            const status = document.getElementById('status').value;
            const editIndex = document.getElementById('editIndex').value;
            
            if (!callSign) {
                await showAlert('Please enter a call sign', 'Missing Information');
                return;
            }
            
            let ambulances = getAmbulances();
            
            // Check for duplicate call signs (except when editing)
            const existingIndex = ambulances.findIndex(amb => amb.callSign === callSign);
            if (existingIndex !== -1 && existingIndex != editIndex) {
                await showAlert('Call sign already exists!', 'Duplicate Call Sign');
                return;
            }
            
            if(editIndex !== '') {
                ambulances[editIndex] = { callSign, status };
                showMessage('Ambulance updated!');
            } else {
                ambulances.push({ callSign, status });
                showMessage('Ambulance added!');
            }
            
            saveAmbulances(ambulances);
            this.reset();
            document.getElementById('editIndex').value = '';
            document.getElementById('cancelEdit').style.display = 'none';
            loadAmbulances();
        };
        window.editAmbulance = function(idx) {
            const amb = getAmbulances()[idx];
            document.getElementById('callSign').value = amb.callSign;
            document.getElementById('status').value = amb.status;
            document.getElementById('editIndex').value = idx;
            document.getElementById('cancelEdit').style.display = 'inline-block';
        };
        window.deleteAmbulance = async function(idx) {
            let ambulances = getAmbulances();
            if(await showConfirm(`Delete ambulance ${ambulances[idx].callSign}?`, 'Delete Ambulance')) {
                ambulances.splice(idx,1);
                saveAmbulances(ambulances);
                showMessage('Ambulance deleted!');
                loadAmbulances();
            }
        };
        document.getElementById('cancelEdit').onclick = function() {
            document.getElementById('ambulanceForm').reset();
            document.getElementById('editIndex').value = '';
            this.style.display = 'none';
        };
        // Toggle ambulance status between Available and Out of Service
        window.toggleAmbulanceStatus = function(idx) {
            let ambulances = getAmbulances();
            const ambulance = ambulances[idx];
            
            // Toggle between Available and Out of Service (skip On Call for quick toggle)
            if (ambulance.status === 'Available') {
                ambulance.status = 'Out of Service';
                showMessage(`${ambulance.callSign} set to Out of Service`);
            } else {
                ambulance.status = 'Available';
                showMessage(`${ambulance.callSign} set to Available`);
            }
            
            saveAmbulances(ambulances);
            loadAmbulances();
        };
        // Check if user is logged in
        if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'index.html';
        }
        
        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            if (await showConfirm('Are you sure you want to logout?', 'Logout')) {
                localStorage.removeItem('isLoggedIn');
                window.location.href = 'index.html';
            }
        });
        
        loadAmbulances();
        
        // Apply dark mode if enabled
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }
    </script>
</body>
</html>