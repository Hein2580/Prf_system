<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Patient Report Form (PRF)</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .prf-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .form-section {
            background: #f8f9fa;
            margin: 1rem 0;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #1976d2;
        }
        .form-section h3 {
            margin-top: 0;
            color: #1976d2;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 0.5rem;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            font-weight: 500;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9rem;
            margin: 0;
        }
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        .vitals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
        }
        .body-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        .body-figure {
            position: relative;
            cursor: crosshair;
            border: 2px solid #ccc;
            border-radius: 8px;
            padding: 1rem;
            background: white;
        }
        .body-svg {
            width: 200px;
            height: 350px;
            border: 2px solid #ddd;
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .body-regions rect:hover {
            fill: rgba(255, 0, 0, 0.1);
            stroke: #ff0000;
            stroke-width: 1;
        }
        .injury-marker {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #ff0000;
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .injury-legend {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid #ccc;
            max-width: 300px;
        }
        .injury-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .injury-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #eee;
        }
        .injury-item button {
            background: #ff0000;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            margin: 0;
        }
        .dark-mode .form-section {
            background: #3d3d3d;
        }
        .dark-mode .body-figure,
        .dark-mode .injury-legend {
            background: #3d3d3d;
            border-color: #555;
        }
        .dark-mode .injury-item {
            border-color: #555;
        }
        .time-input {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.5rem;
        }
        .narrative-section {
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <header>
        <h1>Patient Report Form (PRF)</h1>
        <p>Comprehensive Emergency Medical Documentation</p>
    </header>
    <nav>
        <a href="dashboard.html">Dashboard</a>
        <a href="ambulance-directory.html">Ambulance Directory</a>
        <a href="checklist.html">Checklist</a>
                        <a href="prf-form.html" class="active">PRF Form</a>
        <a href="trip-log.html">Trip Log</a>
        <a href="settings.html">Settings</a>
        <button id="logoutBtn" style="background:#b71c1c;margin-left:auto;">Logout</button>
    </nav>
    <main class="prf-container">
        <form id="prfForm">

            <div class="form-section">
                <h3>Incident Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="incidentNumber">Incident Number</label>
                        <input type="text" id="incidentNumber" name="incidentNumber">
                    </div>
                    <div class="form-group">
                        <label for="ambulanceUnit">Ambulance Unit</label>
                        <select id="ambulanceUnit" name="ambulanceUnit" required></select>
                    </div>
                    <div class="form-group">
                        <label for="incidentDate">Date</label>
                        <input type="date" id="incidentDate" name="incidentDate" required>
                    </div>
                    <div class="form-group">
                        <label>Time Called</label>
                        <div class="time-input">
                            <input type="number" placeholder="HH" min="0" max="23" id="timeCalledHour">
                            <input type="number" placeholder="MM" min="0" max="59" id="timeCalledMin">
                            <select id="timeCalledAmPm"><option>AM</option><option>PM</option></select>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="incidentLocation">Location</label>
                        <input type="text" id="incidentLocation" name="incidentLocation" required>
                    </div>
                    <div class="form-group">
                        <label for="chiefComplaint">Chief Complaint</label>
                        <input type="text" id="chiefComplaint" name="chiefComplaint" required>
                    </div>
                </div>
            </div>


            <div class="form-section">
                <h3>Patient Demographics</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="patientName">Patient Name</label>
                        <input type="text" id="patientName" name="patientName" required>
                    </div>
                    <div class="form-group">
                        <label for="patientAge">Age</label>
                        <input type="number" id="patientAge" name="patientAge" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="patientGender">Gender</label>
                        <select id="patientGender" name="patientGender" required>
                            <option value="">Select</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="patientWeight">Weight (kg)</label>
                        <input type="number" id="patientWeight" name="patientWeight">
                    </div>
                </div>
            </div>


            <div class="form-section">
                <h3>Vital Signs</h3>
                <div class="vitals-grid">
                    <div class="form-group">
                        <label for="bloodPressureSys">BP Systolic</label>
                        <input type="number" id="bloodPressureSys" name="bloodPressureSys">
                    </div>
                    <div class="form-group">
                        <label for="bloodPressureDia">BP Diastolic</label>
                        <input type="number" id="bloodPressureDia" name="bloodPressureDia">
                    </div>
                    <div class="form-group">
                        <label for="pulse">Pulse (BPM)</label>
                        <input type="number" id="pulse" name="pulse">
                    </div>
                    <div class="form-group">
                        <label for="respiratory">Resp Rate</label>
                        <input type="number" id="respiratory" name="respiratory">
                    </div>
                    <div class="form-group">
                        <label for="temperature">Temperature (Â°C)</label>
                        <input type="number" id="temperature" name="temperature" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="oxygenSat">O2 Sat (%)</label>
                        <input type="number" id="oxygenSat" name="oxygenSat" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label for="glucoseLevel">Glucose (mg/dL)</label>
                        <input type="number" id="glucoseLevel" name="glucoseLevel">
                    </div>
                    <div class="form-group">
                        <label for="painScale">Pain Scale (0-10)</label>
                        <input type="number" id="painScale" name="painScale" min="0" max="10">
                    </div>
                </div>
            </div>


            <div class="form-section">
                <h3>Assessment & Symptoms</h3>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="symptom_chest_pain" name="symptoms" value="Chest Pain">
                        <label for="symptom_chest_pain">Chest Pain</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="symptom_shortness_breath" name="symptoms" value="Shortness of Breath">
                        <label for="symptom_shortness_breath">Shortness of Breath</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="symptom_nausea" name="symptoms" value="Nausea">
                        <label for="symptom_nausea">Nausea/Vomiting</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="symptom_headache" name="symptoms" value="Headache">
                        <label for="symptom_headache">Headache</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="symptom_dizziness" name="symptoms" value="Dizziness">
                        <label for="symptom_dizziness">Dizziness</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="symptom_abdominal_pain" name="symptoms" value="Abdominal Pain">
                        <label for="symptom_abdominal_pain">Abdominal Pain</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="symptom_altered_mental" name="symptoms" value="Altered Mental Status">
                        <label for="symptom_altered_mental">Altered Mental Status</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="symptom_trauma" name="symptoms" value="Trauma">
                        <label for="symptom_trauma">Trauma</label>
                    </div>
                </div>
            </div>


            <div class="form-section">
                <h3>Injury/Pain Location</h3>
                <div class="body-diagram">
                    <div class="body-figure" id="bodyFigureFront">
                        <h4 style="text-align: center; margin-top: 0;">Front</h4>
                        <svg class="body-svg" viewBox="0 0 200 320">

                            <path d="M100 15 C112 15 120 23 120 35 C120 47 112 55 100 55 C88 55 80 47 80 35 C80 23 88 15 100 15 Z" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1.2"/>

                            <circle cx="92" cy="32" r="1.2" fill="#2c3e50"/>
                            <circle cx="108" cy="32" r="1.2" fill="#2c3e50"/>
                            <path d="M98 40 Q100 42 102 40" fill="none" stroke="#2c3e50" stroke-width="0.8"/>
                            <path d="M95 46 Q100 48 105 46" fill="none" stroke="#2c3e50" stroke-width="0.8"/>
                            
                            <!-- Neck -->
                            <path d="M92 55 Q92 58 95 60 L105 60 Q108 58 108 55 L108 70 Q105 72 95 72 Q92 70 92 55 Z" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1.2"/>
                            
                            <!-- Torso (smooth curves) -->
                            <path d="M95 72 Q75 75 65 85 Q60 95 65 120 Q70 140 75 150 Q80 158 100 158 Q120 158 125 150 Q130 140 135 120 Q140 95 135 85 Q125 75 105 72 Z" fill="#e8f4f8" stroke="#2c3e50" stroke-width="1.2"/>
                            
                            <!-- Chest definition -->
                            <path d="M85 90 Q88 95 92 100 Q95 105 100 108 Q105 105 108 100 Q112 95 115 90" fill="none" stroke="#34495e" stroke-width="0.8" opacity="0.4"/>
                            <path d="M100 72 Q100 85 100 108" stroke="#34495e" stroke-width="0.6" opacity="0.3"/>
                            
                            <!-- Abdomen -->
                            <path d="M75 158 Q70 165 72 180 Q75 195 80 205 Q85 210 100 210 Q115 210 120 205 Q125 195 128 180 Q130 165 125 158 Z" fill="#e8f4f8" stroke="#2c3e50" stroke-width="1.2"/>
                            
                            <!-- Pelvis -->
                            <path d="M80 210 Q75 215 78 225 Q82 235 100 235 Q118 235 122 225 Q125 215 120 210 Z" fill="#e8f4f8" stroke="#2c3e50" stroke-width="1.2"/>
                            
                            <!-- Left Arm (smooth curves) -->
                            <path d="M65 85 Q50 90 45 105 Q40 120 42 135 Q45 150 48 165 Q50 175 45 185 Q40 190 38 195" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1.2"/>
                            <!-- Left hand -->
                            <ellipse cx="38" cy="195" rx="4" ry="7" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1"/>
                            
                            <!-- Right Arm (smooth curves) -->
                            <path d="M135 85 Q150 90 155 105 Q160 120 158 135 Q155 150 152 165 Q150 175 155 185 Q160 190 162 195" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1.2"/>
                            <!-- Right hand -->
                            <ellipse cx="162" cy="195" rx="4" ry="7" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1"/>
                            
                            <!-- Left Leg (smooth curves) -->
                            <path d="M82 235 Q78 250 80 270 Q82 290 85 310 Q87 325 82 335 Q78 340 75 345" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1.2"/>
                            <!-- Left foot -->
                            <ellipse cx="75" cy="345" rx="8" ry="4" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1"/>
                            
                            <!-- Right Leg (smooth curves) -->
                            <path d="M118 235 Q122 250 120 270 Q118 290 115 310 Q113 325 118 335 Q122 340 125 345" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1.2"/>
                            <!-- Right foot -->
                            <ellipse cx="125" cy="345" rx="8" ry="4" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1"/>
                            
                            <!-- Subtle body details -->
                            <circle cx="88" cy="98" r="3" fill="none" stroke="#34495e" stroke-width="0.5" opacity="0.3"/>
                            <circle cx="112" cy="98" r="3" fill="none" stroke="#34495e" stroke-width="0.5" opacity="0.3"/>
                            
                            <!-- Body region labels (invisible clickable areas) -->
                            <g class="body-regions">
                                <ellipse cx="100" cy="35" rx="20" ry="25" fill="transparent" data-region="head" style="cursor: pointer;"/>
                                <rect x="92" y="55" width="16" height="17" fill="transparent" data-region="neck" style="cursor: pointer;"/>
                                <path d="M65 72 Q135 72 135 158 Q65 158 65 72 Z" fill="transparent" data-region="chest" style="cursor: pointer;"/>
                                <path d="M70 158 Q130 158 130 210 Q70 210 70 158 Z" fill="transparent" data-region="abdomen" style="cursor: pointer;"/>
                                <path d="M75 210 Q125 210 125 235 Q75 235 75 210 Z" fill="transparent" data-region="pelvis" style="cursor: pointer;"/>
                                <path d="M35 85 Q65 85 65 200 Q35 200 35 85 Z" fill="transparent" data-region="left-arm" style="cursor: pointer;"/>
                                <path d="M135 85 Q165 85 165 200 Q135 200 135 85 Z" fill="transparent" data-region="right-arm" style="cursor: pointer;"/>
                                <path d="M70 235 Q95 235 95 350 Q70 350 70 235 Z" fill="transparent" data-region="left-leg" style="cursor: pointer;"/>
                                <path d="M105 235 Q130 235 130 350 Q105 350 105 235 Z" fill="transparent" data-region="right-leg" style="cursor: pointer;"/>
                                <circle cx="38" cy="195" r="8" fill="transparent" data-region="left-hand" style="cursor: pointer;"/>
                                <circle cx="162" cy="195" r="8" fill="transparent" data-region="right-hand" style="cursor: pointer;"/>
                                <ellipse cx="75" cy="345" rx="12" ry="8" fill="transparent" data-region="left-foot" style="cursor: pointer;"/>
                                <ellipse cx="125" cy="345" rx="12" ry="8" fill="transparent" data-region="right-foot" style="cursor: pointer;"/>
                            </g>
                        </svg>
                    </div>
                    <div class="body-figure" id="bodyFigureBack">
                        <h4 style="text-align: center; margin-top: 0;">Back</h4>
                        <svg class="body-svg" viewBox="0 0 200 320">
                            <!-- Smooth, realistic human body outline - back view -->
                            <!-- Head -->
                            <path d="M100 15 C112 15 120 23 120 35 C120 47 112 55 100 55 C88 55 80 47 80 35 C80 23 88 15 100 15 Z" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1.2"/>
                            <!-- Hair -->
                            <path d="M82 22 Q100 12 118 22 Q115 18 100 16 Q85 18 82 22 Z" fill="#8b4513" stroke="#2c3e50" stroke-width="0.8"/>
                            
                            <!-- Neck -->
                            <path d="M92 55 Q92 58 95 60 L105 60 Q108 58 108 55 L108 70 Q105 72 95 72 Q92 70 92 55 Z" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1.2"/>
                            
                            <!-- Upper Back (smooth curves) -->
                            <path d="M95 72 Q75 75 65 85 Q60 95 65 120 Q70 140 75 150 Q80 158 100 158 Q120 158 125 150 Q130 140 135 120 Q140 95 135 85 Q125 75 105 72 Z" fill="#e8f4f8" stroke="#2c3e50" stroke-width="1.2"/>
                            
                            <!-- Spine (smooth curved line) -->
                            <path d="M100 72 Q99 90 100 108 Q101 126 100 144 Q99 152 100 158" stroke="#34495e" stroke-width="1.5" opacity="0.4" fill="none"/>
                            <!-- Vertebrae -->
                            <circle cx="100" cy="85" r="1.5" fill="#34495e" opacity="0.3"/>
                            <circle cx="100" cy="100" r="1.5" fill="#34495e" opacity="0.3"/>
                            <circle cx="100" cy="115" r="1.5" fill="#34495e" opacity="0.3"/>
                            <circle cx="100" cy="130" r="1.5" fill="#34495e" opacity="0.3"/>
                            <circle cx="100" cy="145" r="1.5" fill="#34495e" opacity="0.3"/>
                            
                            <!-- Shoulder blades (smooth curves) -->
                            <path d="M82 88 Q88 95 85 110 Q82 125 78 135" fill="none" stroke="#34495e" stroke-width="1" opacity="0.3"/>
                            <path d="M118 88 Q112 95 115 110 Q118 125 122 135" fill="none" stroke="#34495e" stroke-width="1" opacity="0.3"/>
                            
                            <!-- Lower Back -->
                            <path d="M75 158 Q70 165 72 180 Q75 195 80 205 Q85 210 100 210 Q115 210 120 205 Q125 195 128 180 Q130 165 125 158 Z" fill="#e8f4f8" stroke="#2c3e50" stroke-width="1.2"/>
                            
                            <!-- Pelvis -->
                            <path d="M80 210 Q75 215 78 225 Q82 235 100 235 Q118 235 122 225 Q125 215 120 210 Z" fill="#e8f4f8" stroke="#2c3e50" stroke-width="1.2"/>
                            
                            <!-- Left Arm (smooth curves) -->
                            <path d="M65 85 Q50 90 45 105 Q40 120 42 135 Q45 150 48 165 Q50 175 45 185 Q40 190 38 195" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1.2"/>
                            <!-- Left hand -->
                            <ellipse cx="38" cy="195" rx="4" ry="7" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1"/>
                            
                            <!-- Right Arm (smooth curves) -->
                            <path d="M135 85 Q150 90 155 105 Q160 120 158 135 Q155 150 152 165 Q150 175 155 185 Q160 190 162 195" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1.2"/>
                            <!-- Right hand -->
                            <ellipse cx="162" cy="195" rx="4" ry="7" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1"/>
                            
                            <!-- Left Leg (smooth curves) -->
                            <path d="M82 235 Q78 250 80 270 Q82 290 85 310 Q87 325 82 335 Q78 340 75 345" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1.2"/>
                            <!-- Left foot -->
                            <ellipse cx="75" cy="345" rx="8" ry="4" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1"/>
                            
                            <!-- Right Leg (smooth curves) -->
                            <path d="M118 235 Q122 250 120 270 Q118 290 115 310 Q113 325 118 335 Q122 340 125 345" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1.2"/>
                            <!-- Right foot -->
                            <ellipse cx="125" cy="345" rx="8" ry="4" fill="#fdd5b8" stroke="#2c3e50" stroke-width="1"/>
                            
                            <!-- Body region labels (invisible clickable areas) -->
                            <g class="body-regions">
                                <ellipse cx="100" cy="35" rx="20" ry="25" fill="transparent" data-region="head" style="cursor: pointer;"/>
                                <rect x="92" y="55" width="16" height="17" fill="transparent" data-region="neck" style="cursor: pointer;"/>
                                <path d="M65 72 Q135 72 135 158 Q65 158 65 72 Z" fill="transparent" data-region="upper-back" style="cursor: pointer;"/>
                                <path d="M70 158 Q130 158 130 210 Q70 210 70 158 Z" fill="transparent" data-region="lower-back" style="cursor: pointer;"/>
                                <path d="M75 210 Q125 210 125 235 Q75 235 75 210 Z" fill="transparent" data-region="pelvis" style="cursor: pointer;"/>
                                <path d="M35 85 Q65 85 65 200 Q35 200 35 85 Z" fill="transparent" data-region="left-arm" style="cursor: pointer;"/>
                                <path d="M135 85 Q165 85 165 200 Q135 200 135 85 Z" fill="transparent" data-region="right-arm" style="cursor: pointer;"/>
                                <path d="M70 235 Q95 235 95 350 Q70 350 70 235 Z" fill="transparent" data-region="left-leg" style="cursor: pointer;"/>
                                <path d="M105 235 Q130 235 130 350 Q105 350 105 235 Z" fill="transparent" data-region="right-leg" style="cursor: pointer;"/>
                                <circle cx="38" cy="195" r="8" fill="transparent" data-region="left-hand" style="cursor: pointer;"/>
                                <circle cx="162" cy="195" r="8" fill="transparent" data-region="right-hand" style="cursor: pointer;"/>
                                <ellipse cx="75" cy="345" rx="12" ry="8" fill="transparent" data-region="left-foot" style="cursor: pointer;"/>
                                <ellipse cx="125" cy="345" rx="12" ry="8" fill="transparent" data-region="right-foot" style="cursor: pointer;"/>
                            </g>
                        </svg>
                    </div>
                    <div class="injury-legend">
                        <h4>Injury Markers</h4>
                        <p style="font-size: 0.9rem;">Click on body diagram to mark injuries</p>
                        <div class="injury-list" id="injuryList">
                            <div style="text-align: center; color: #666; font-style: italic;">No injuries marked</div>
                        </div>
                        <button type="button" id="clearInjuries" style="width: 100%; margin-top: 0.5rem;">Clear All</button>
                    </div>
                </div>
            </div>


            <div class="form-section">
                <h3>Medications Given</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="medicationsGiven">Medications Administered</label>
                        <textarea id="medicationsGiven" name="medicationsGiven" rows="3" placeholder="List medications, dosages, and times..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="allergies">Known Allergies</label>
                        <textarea id="allergies" name="allergies" rows="3" placeholder="List known allergies..."></textarea>
                    </div>
                </div>
            </div>


            <div class="form-section">
                <h3>Procedures Performed</h3>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="proc_oxygen" name="procedures" value="Oxygen Administration">
                        <label for="proc_oxygen">Oxygen Administration</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="proc_iv" name="procedures" value="IV Access">
                        <label for="proc_iv">IV Access</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="proc_ekg" name="procedures" value="EKG">
                        <label for="proc_ekg">EKG</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="proc_splinting" name="procedures" value="Splinting">
                        <label for="proc_splinting">Splinting</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="proc_bandaging" name="procedures" value="Bandaging">
                        <label for="proc_bandaging">Bandaging</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="proc_cpr" name="procedures" value="CPR">
                        <label for="proc_cpr">CPR</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="proc_immobilization" name="procedures" value="Spinal Immobilization">
                        <label for="proc_immobilization">Spinal Immobilization</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="proc_airway" name="procedures" value="Airway Management">
                        <label for="proc_airway">Airway Management</label>
                    </div>
                </div>
            </div>


            <div class="form-section">
                <h3>Narrative</h3>
                <div class="form-row">
                    <div class="form-group narrative-section">
                        <label for="narrative">Detailed Description of Incident and Treatment</label>
                        <textarea id="narrative" name="narrative" rows="6" required placeholder="Provide detailed narrative of the incident, patient condition, treatment provided, and patient response..."></textarea>
                    </div>
                </div>
            </div>


            <div class="form-section">
                <h3>Patient Disposition</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="disposition">Disposition</label>
                        <select id="disposition" name="disposition" required>
                            <option value="">Select</option>
                            <option value="Transported to Hospital">Transported to Hospital</option>
                            <option value="Refused Treatment">Refused Treatment</option>
                            <option value="Treated and Released">Treated and Released</option>
                            <option value="DOA">DOA</option>
                            <option value="No Treatment Required">No Treatment Required</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="hospitalDestination">Hospital Destination</label>
                        <input type="text" id="hospitalDestination" name="hospitalDestination">
                    </div>
                    <div class="form-group">
                        <label for="crewMember">Primary Crew Member</label>
                        <input type="text" id="crewMember" name="crewMember" required>
                    </div>
                </div>
            </div>

            <input type="hidden" id="editPRFIndex">
            <input type="hidden" id="injuryData" name="injuryData">
            
            <div style="text-align: center; margin: 2rem 0;">
                <button type="submit">Save PRF</button>
                <button type="button" id="loadPRF" style="margin-left:1rem;">Load Last PRF</button>
                <button type="button" id="resetForm" style="margin-left:1rem;">Reset Form</button>
            </div>
        </form>
        
        <div id="prfSavedMsg" style="display:none;color:green;text-align:center;margin:1rem;">PRF saved!</div>
        
        <h2>PRF History</h2>
        <input type="text" id="prfSearch" placeholder="Search by patient, date, or ambulance..." style="width:100%;margin-bottom:1rem;">
        <div class="table-container">
            <table id="prfTable">
            <thead>
                <tr>
                    <th>Patient</th>
                    <th>Date</th>
                    <th>Chief Complaint</th>
                    <th>Ambulance</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
        </div>
    </main>

    <script src="tools.js"></script>
    <script>
        let injuries = [];
        
        // Enhanced PRF Form Logic
        function getPRFs() {
            return JSON.parse(localStorage.getItem('prfs') || '[]');
        }
        function savePRFs(arr) {
            localStorage.setItem('prfs', JSON.stringify(arr));
        }
        function getAmbulances() {
            return JSON.parse(localStorage.getItem('ambulances') || '[]');
        }
        
        // Body diagram interaction
        function setupBodyDiagram() {
            const frontFigure = document.getElementById('bodyFigureFront');
            const backFigure = document.getElementById('bodyFigureBack');
            
            [frontFigure, backFigure].forEach(figure => {
                figure.addEventListener('click', async function(e) {
                    const rect = figure.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const view = figure.id === 'bodyFigureFront' ? 'front' : 'back';
                    
                    await addInjuryMarker(figure, x, y, view);
                });
            });
            
            document.getElementById('clearInjuries').addEventListener('click', clearAllInjuries);
        }
        
        async function addInjuryMarker(figure, x, y, view) {
            const injuryType = await showPrompt('Enter injury type:', 'Add Injury Marker', 'Contusion');
            if (!injuryType) return;
            
            const marker = document.createElement('div');
            marker.className = 'injury-marker';
            marker.style.left = (x - 6) + 'px';
            marker.style.top = (y - 6) + 'px';
            marker.title = injuryType;
            
            const injuryId = Date.now();
            marker.dataset.injuryId = injuryId;
            
            marker.addEventListener('click', async function(e) {
                e.stopPropagation();
                if (await showConfirm('Remove this injury marker?', 'Remove Injury')) {
                    removeInjuryMarker(injuryId);
                }
            });
            
            figure.appendChild(marker);
            
            injuries.push({
                id: injuryId,
                x: x,
                y: y,
                view: view,
                type: injuryType
            });
            
            updateInjuryList();
            updateInjuryData();
        }
        
        function removeInjuryMarker(injuryId) {
            const marker = document.querySelector(`[data-injury-id="${injuryId}"]`);
            if (marker) marker.remove();
            
            injuries = injuries.filter(injury => injury.id !== injuryId);
            updateInjuryList();
            updateInjuryData();
        }
        
        async function clearAllInjuries() {
            if (injuries.length === 0) return;
            if (!await showConfirm('Clear all injury markers?', 'Clear All Injuries')) return;
            
            document.querySelectorAll('.injury-marker').forEach(marker => marker.remove());
            injuries = [];
            updateInjuryList();
            updateInjuryData();
        }
        
        function updateInjuryList() {
            const injuryList = document.getElementById('injuryList');
            if (injuries.length === 0) {
                injuryList.innerHTML = '<div style="text-align: center; color: #666; font-style: italic;">No injuries marked</div>';
                return;
            }
            
            injuryList.innerHTML = injuries.map(injury => `
                <div class="injury-item">
                    <span>${injury.type} (${injury.view})</span>
                    <button onclick="removeInjuryMarker(${injury.id})">Remove</button>
    </div>
            `).join('');
        }
        
        function updateInjuryData() {
            document.getElementById('injuryData').value = JSON.stringify(injuries);
        }
        
        function loadInjuries(injuryData) {
            if (!injuryData) return;
            
            clearAllInjuries();
            injuries = JSON.parse(injuryData);
            
            injuries.forEach(injury => {
                const figure = document.getElementById(injury.view === 'front' ? 'bodyFigureFront' : 'bodyFigureBack');
                const marker = document.createElement('div');
                marker.className = 'injury-marker';
                marker.style.left = (injury.x - 6) + 'px';
                marker.style.top = (injury.y - 6) + 'px';
                marker.title = injury.type;
                marker.dataset.injuryId = injury.id;
                
                marker.addEventListener('click', async function(e) {
                    e.stopPropagation();
                    if (await showConfirm('Remove this injury marker?', 'Remove Injury')) {
                        removeInjuryMarker(injury.id);
                    }
                });
                
                figure.appendChild(marker);
            });
            
            updateInjuryList();
        }
        
            function populateAmbulanceSelect() {
        const select = document.getElementById('ambulanceUnit');
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        
        select.innerHTML = '<option value="">Select Ambulance</option>';
        
        if (currentUser.role === 'Administrator') {
            // Admin can see all ambulances
            getAmbulances().forEach(amb => {
                const opt = document.createElement('option');
                opt.value = amb.callSign;
                opt.textContent = amb.callSign;
                select.appendChild(opt);
            });
        } else if (currentUser.assignedAmbulance) {
            // Paramedic/EMT can only see their assigned ambulance
            const opt = document.createElement('option');
            opt.value = currentUser.assignedAmbulance;
            opt.textContent = currentUser.assignedAmbulance;
            opt.selected = true;
            select.appendChild(opt);
            select.disabled = true; // Disable selection for non-admin users
        }
    }
        
        function collectFormData() {
            const form = document.getElementById('prfForm');
            const data = {};
            
            // Collect all form fields
            const inputs = form.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    if (!data.checkboxes) data.checkboxes = {};
                    data.checkboxes[input.name] = data.checkboxes[input.name] || [];
                    if (input.checked) {
                        data.checkboxes[input.name].push(input.value);
                    }
                } else {
                    data[input.name] = input.value;
                }
            });
            
            // Combine time fields
            const timeCalledHour = document.getElementById('timeCalledHour').value;
            const timeCalledMin = document.getElementById('timeCalledMin').value;
            const timeCalledAmPm = document.getElementById('timeCalledAmPm').value;
            if (timeCalledHour && timeCalledMin) {
                data.timeCalled = `${timeCalledHour.padStart(2, '0')}:${timeCalledMin.padStart(2, '0')} ${timeCalledAmPm}`;
            }
            
            data.injuries = JSON.stringify(injuries);
            data.timestamp = new Date().toISOString();
            
            return data;
        }
        
            function renderPRFTable() {
        const prfs = getPRFs();
        const search = document.getElementById('prfSearch').value.toLowerCase();
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        const tbody = document.querySelector('#prfTable tbody');
        tbody.innerHTML = '';
        
        prfs.forEach((prf, idx) => {
            // Filter PRFs based on user role
            const isVisible = currentUser.role === 'Administrator' || 
                             (currentUser.assignedAmbulance && prf.ambulanceUnit === currentUser.assignedAmbulance);
            
            if (isVisible && (
                (prf.patientName && prf.patientName.toLowerCase().includes(search)) ||
                (prf.incidentDate && prf.incidentDate.includes(search)) ||
                (prf.ambulanceUnit && prf.ambulanceUnit.toLowerCase().includes(search)) ||
                (prf.chiefComplaint && prf.chiefComplaint.toLowerCase().includes(search))
            )) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${prf.patientName || 'Unknown'}</td>
                    <td>${prf.incidentDate || 'Unknown'}</td>
                    <td>${prf.chiefComplaint || 'Not specified'}</td>
                    <td>${prf.ambulanceUnit || 'Unknown'}</td>
                    <td>
                        <button onclick="editPRF(${idx})">Edit</button>
                        <button onclick="deletePRF(${idx})" style="background:#b71c1c;">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            }
        });
    }
        
        document.getElementById('prfForm').onsubmit = function(e) {
            e.preventDefault();
            const data = collectFormData();
            let prfs = getPRFs();
            const editIdx = document.getElementById('editPRFIndex').value;
            
            if(editIdx !== '') {
                prfs[editIdx] = data;
            } else {
                prfs.push(data);
            }
            
            savePRFs(prfs);
            document.getElementById('prfSavedMsg').style.display = 'block';
            setTimeout(() => {
                document.getElementById('prfSavedMsg').style.display = 'none';
            }, 2000);
            
            renderPRFTable();
        };
        
        window.editPRF = function(idx) {
            const prf = getPRFs()[idx];
            const form = document.getElementById('prfForm');
            
            // Populate all form fields
            Object.keys(prf).forEach(key => {
                const element = form.querySelector(`[name="${key}"]`);
                if (element) {
                    if (element.type === 'checkbox') {
                        element.checked = false;
                    } else {
                        element.value = prf[key] || '';
                    }
                }
            });
            
            // Handle checkboxes
            if (prf.checkboxes) {
                Object.keys(prf.checkboxes).forEach(checkboxGroup => {
                    prf.checkboxes[checkboxGroup].forEach(value => {
                        const checkbox = form.querySelector(`input[name="${checkboxGroup}"][value="${value}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                });
            }
            
            // Load injuries
            if (prf.injuries) {
                loadInjuries(prf.injuries);
            }
            
            document.getElementById('editPRFIndex').value = idx;
        };
        
        window.deletePRF = async function(idx) {
            if(await showConfirm('Delete this PRF?', 'Delete PRF')) {
                let prfs = getPRFs();
                prfs.splice(idx,1);
                savePRFs(prfs);
                renderPRFTable();
            }
        };
        
        document.getElementById('resetForm').onclick = function() {
            document.getElementById('prfForm').reset();
            document.getElementById('editPRFIndex').value = '';
            clearAllInjuries();
        };
        
        document.getElementById('prfSearch').oninput = renderPRFTable;
        
        // Check if user is logged in
        if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'index.html';
        }
        
        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            if (await showConfirm('Are you sure you want to logout?', 'Logout')) {
                localStorage.removeItem('isLoggedIn');
                window.location.href = 'index.html';
            }
        });
        
        // Apply dark mode if enabled
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }
        
            // Initialize
    populateAmbulanceSelect();
    renderPRFTable();
    setupBodyDiagram();
    setupRoleBasedNavigation();
    
    // Set current date as default
    document.getElementById('incidentDate').value = new Date().toISOString().split('T')[0];
    </script>
</body>
</html>