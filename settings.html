<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Settings - Ambulance PRF System</title>
  <link rel="stylesheet" href="style.css?v=2">
</head>
<body>
  <header>
    <h1>Settings</h1>
    <p>Manage your system preferences and data</p>
  </header>
  <nav>
    <a href="dashboard.html">Dashboard</a>
    <a href="ambulance-directory.html">Ambulance Directory</a>
    <a href="checklist.html">Checklist</a>
                            <a href="prf-form.html">PRF Form</a>
        <a href="trip-log.html">Trip Log</a>
        <a href="settings.html" class="active">Settings</a>
    <button id="logoutBtn" style="background:#b71c1c;margin-left:auto;">Logout</button>
  </nav>
  <main>
    <h2>Data Management</h2>
    <div style="margin-bottom:2rem;">
      <h3>Export Data</h3>
      <p>Export all your data as a JSON file for backup:</p>
      <button id="exportData" class="btn-primary" style="background:#1976d2;color:white;">Export All Data</button>
      <button id="downloadData" class="btn-secondary" style="background:#4b5563;color:white;margin-left:1rem;">Download Data</button>
    </div>
    
    <div style="margin-bottom:2rem;">
      <h3>Import Data</h3>
      <p>Import data from a previously exported JSON file:</p>
      <input type="file" id="importFile" accept=".json">
      <button id="importData">Import Data</button>
    </div>
    
    <div style="margin-bottom:2rem;">
      <h3>Clear All Data</h3>
      <p style="color:#b71c1c;">Warning: This will delete all ambulances, checklists, and PRFs!</p>
      <button id="clearData" style="background:#b71c1c;">Clear All Data</button>
    </div>
    
    <h2>Appearance</h2>
    <div style="margin-bottom:2rem;">
      <h3>Dark Mode</h3>
      <label>
        <input type="checkbox" id="darkModeToggle"> Enable Dark Mode
      </label>
    </div>
    
    <h2>System Info</h2>
    <div id="systemInfo">
      <p><strong>Ambulances:</strong> <span id="ambulanceCount">0</span></p>
      <p><strong>PRFs:</strong> <span id="prfCount">0</span></p>
      <p><strong>Storage Used:</strong> <span id="storageUsed">0 KB</span></p>
    </div>
    
    <div id="settingsMsg" style="display:none;margin-top:1rem;"></div>
  </main>
  <script src="tools.js?v=2"></script>
  <script src="navigation.js?v=2"></script>
  <script src="version.js?v=2"></script>
  <script>
    function updateSystemInfo() {
      document.getElementById('ambulanceCount').textContent = getAmbulances().length;
      document.getElementById('prfCount').textContent = getPRFs().length;
      
      // Calculate storage usage
      let totalSize = 0;
      for (let key in localStorage) {
        if (localStorage.hasOwnProperty(key)) {
          totalSize += localStorage[key].length;
        }
      }
      document.getElementById('storageUsed').textContent = Math.round(totalSize / 1024) + ' KB';
    }
    
    function showMessage(msg, isError = false) {
      const msgDiv = document.getElementById('settingsMsg');
      msgDiv.textContent = msg;
      msgDiv.style.color = isError ? '#b71c1c' : 'green';
      msgDiv.style.display = 'block';
      setTimeout(() => {
        msgDiv.style.display = 'none';
      }, 3000);
    }
    
    // Export data
    document.getElementById('exportData').onclick = function() {
      try {
        const data = exportAllData();
        const blob = new Blob([data], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ambulance-prf-backup-' + new Date().toISOString().split('T')[0] + '.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showMessage('Data exported successfully!');
      } catch (e) {
        showMessage('Export failed: ' + e.message, true);
      }
    };
    
    // Import data
    document.getElementById('importData').onclick = function() {
      const fileInput = document.getElementById('importFile');
      const file = fileInput.files[0];
      if (!file) {
        showMessage('Please select a file to import', true);
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const success = importAllData(e.target.result);
          if (success) {
            showMessage('Data imported successfully! Please refresh the page.');
            updateSystemInfo();
          } else {
            showMessage('Import failed: Invalid file format', true);
          }
        } catch (err) {
          showMessage('Import failed: ' + err.message, true);
        }
      };
      reader.readAsText(file);
    };
    
    // Clear all data
    document.getElementById('clearData').onclick = function() {
      if (clearAllData()) {
        showMessage('All data cleared successfully! Please refresh the page.');
        updateSystemInfo();
      }
    };
    
    // Dark mode toggle
    function loadDarkMode() {
      const darkMode = localStorage.getItem('darkMode') === 'true';
      document.getElementById('darkModeToggle').checked = darkMode;
      if (darkMode) {
        document.body.classList.add('dark-mode');
      }
    }
    
    document.getElementById('darkModeToggle').onchange = function() {
      const darkMode = this.checked;
      localStorage.setItem('darkMode', darkMode);
      if (darkMode) {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
      showMessage('Dark mode ' + (darkMode ? 'enabled' : 'disabled'));
    };
    
    // Check if user is logged in
            if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'index.html';
        }
    
            // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            if (await showConfirm('Are you sure you want to logout?', 'Logout')) {
                localStorage.removeItem('isLoggedIn');
                window.location.href = 'index.html';
            }
        });
    
    // Permanent download button handler
    document.getElementById('downloadData').onclick = function() {
      try {
        const data = exportAllData();
        const blob = new Blob([data], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ambulance-prf-backup-' + new Date().toISOString().split('T')[0] + '.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showMessage('Data downloaded successfully!');
      } catch (e) {
        showMessage('Download failed: ' + e.message, true);
      }
    };
    
    // Initialize
    updateSystemInfo();
    loadDarkMode();
    setupRoleBasedNavigation();
  </script>
</body>
</html> 